<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>IXH – Swojska</title>

<style>
/* ====== GLOBAL ====== */
body {
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #f2f2f2;
}

/* ====== PANEL ====== */
.panel {
  max-width: 1100px;
  margin: 20px auto;
  background: #ffffff;
  border: 3px solid #2c2c2c;
  border-radius: 6px;
  box-shadow: 0 0 12px rgba(0,0,0,0.2);
}

/* ====== HEADER ====== */
.header {
  background: #2c2c2c;
  color: #ffffff;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header .title {
  font-size: 20px;
  font-weight: bold;
  letter-spacing: 1px;
}

.header .alarms {
  font-size: 18px;
}

/* ====== GRID ====== */
.grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 10px;
  padding: 16px;
}

/* ====== TILE ====== */
.tile {
  border: 2px solid #2c2c2c;
  border-radius: 4px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: bold;
}

/* ====== STATES ====== */
.tile.ok {
  background: #2ecc71;   /* ZIELONY = OK */
  color: #ffffff;
}

.tile.alarm {
  background: #bfbfbf;   /* SZARY = NIE OK */
  color: #000000;
}

/* ====== HISTORY ====== */
.history {
  border-top: 3px solid #2c2c2c;
  padding: 10px;
}

.history-title {
  font-weight: bold;
  margin-bottom: 6px;
}

.history-box {
  height: 220px;
  overflow-y: auto;
  background: #fafafa;
  border: 1px solid #999999;
  padding: 8px;
  font-family: monospace;
  font-size: 14px;
  white-space: pre-line;
}
</style>
</head>

<body>

<div class="panel">

  <!-- HEADER -->
  <div class="header">
    <div class="title">SYSTEM PRESOSTATÓW</div>
    <div class="alarms" id="headerBar">AKTYWNE ALARMY: 0</div>
  </div>

  <!-- TILES -->
  <div class="grid">
    <script>
      for (let i = 1; i <= 44; i++) {
        document.write(
          '<div class="tile ok" id="p' + i + '">W-' + i + '</div>'
        );
      }
    </script>
  </div>

  <!-- HISTORY -->
  <div class="history">
    <div class="history-title">HISTORIA ZDARZEŃ</div>
    <div class="history-box" id="historyBox"></div>
  </div>

</div>

<!-- ====== JS / WEBSOCKET ====== -->
<script>
let socket;
let lastMsg = 0;

function connectWS() {
  socket = new WebSocket("ws://" + location.hostname + ":81/");

  socket.onmessage = function(event) {
    lastMsg = Date.now();

    let parts = event.data.split(";", 3);
    if (parts.length < 3) return;

    let states = parts[0];
    let alarms = parts[1];
    let history = parts[2];

    for (let i = 0; i < 44; i++) {
      let tile = document.getElementById("p" + (i + 1));
      if (!tile) continue;

      if (states[i] === "1")
        tile.className = "tile ok";
      else
        tile.className = "tile alarm";
    }

    document.getElementById("headerBar").innerText =
      "AKTYWNE ALARMY: " + alarms;

    document.getElementById("historyBox").innerText = history;
  };

  socket.onclose = () => location.reload();
  socket.onerror = () => location.reload();
}

connectWS();
</script>

</body>
</html>
